# Node.js with Angular
# Build a Node.js project that uses Angular.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- main

variables:
  azureSubscription: Contoso

pool:
  vmImage: ubuntu-latest

stages:
- stage: Build
  displayName: Build stage
  jobs:
  - job: Build
    pool:
      vmImage: 'ubuntu-latest'
    steps:
      - task: NodeTool@0
        inputs:
          versionSource: 'spec'
          versionSpec: '16.14.2'
      - task: Npm@1
        displayName: 'Angular CLI'
        inputs:
          command: 'custom'
          verbose: false
          customCommand: 'install @angular/cli@13.3.9'
      - task: Npm@1  
        displayName: 'npm install'  
        inputs:  
          verbose: false 
      - task: Npm@1  
        displayName: Build  
        inputs:  
          command: custom  
          verbose: false  
          customCommand: 'run build'  

- stage: Deploy
  jobs:
  - job: Deploy
    steps:
      - task: CopyPublishBuildArtifacts@1  
        displayName: 'Copy Publish Artifact: test'  
        inputs:  
          CopyRoot: dist  
          Contents: '**'  
          ArtifactName: test  
          ArtifactType: Container  

      - task: DownloadPipelineArtifact@2  
        displayName: 'Download Pipeline Artifact'  
        inputs:  
          targetPath: ' $(Build.ArtifactStagingDirectory)/dist/TicketsV1'      
      - task: PublishBuildArtifacts@1
        inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)'
          ArtifactName: 'drop'
          publishLocation: 'Container'